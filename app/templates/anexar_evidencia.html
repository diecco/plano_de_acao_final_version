{% extends 'layout.html' %}
{% block conteudo %}

<h2 class="mb-4 text-center text-laranja">ANEXAR EVIDÊNCIA</h2>
<hr>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<form method="POST" enctype="multipart/form-data" class="border p-4 rounded bg-light">
    <div class="mb-3">
        <label class="form-label">Descrição da Ação</label>
        <input type="text" class="form-control" value="{{ acao.descricao }}" readonly>
    </div>

    {% if acao.arquivo_evidencia %}
    <div class="mb-3">
        <label class="form-label">Evidência Anexada:</label>
        {% set ext = acao.arquivo_evidencia.split('.')[-1].lower() %}
        {% if ext in ['jpg', 'jpeg', 'png'] %}
            <div class="border p-2 rounded">
                <img src="{{ url_for('static', filename='evidencias/' ~ acao.arquivo_evidencia) }}" alt="Evidência" class="img-fluid">
            </div>
        {% elif ext in ['pdf'] %}
            <div class="border p-2 rounded">
                <embed src="{{ url_for('static', filename='evidencias/' ~ acao.arquivo_evidencia) }}" type="application/pdf" width="100%" height="400px">
            </div>
        {% else %}
            <p><a href="{{ url_for('static', filename='evidencias/' ~ acao.arquivo_evidencia) }}" target="_blank">{{ acao.arquivo_evidencia }}</a></p>
        {% endif %}
    </div>
    {% endif %}

    <div class="mb-3">
        <label for="arquivo" class="form-label">Selecionar novo arquivo (opcional)</label>
        <input type="file" class="form-control" name="arquivo" id="arquivo">
    </div>

    <div class="d-flex justify-content-between">
        <button type="submit" class="btn btn-laranja">Salvar</button>
        <a href="/dashboard" class="btn btn-cinza">Voltar</a>
    </div>
</form>

{% endblock %}
